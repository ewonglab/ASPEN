<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>allelic_variance • ASPEN</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="allelic_variance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ASPEN</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/allelic_imbalance.html">allelic_imbalance</a></li>
    <li><a class="dropdown-item" href="../articles/allelic_variance.html">allelic_variance</a></li>
    <li><a class="dropdown-item" href="../articles/differential_ASE.html">differential_ASE</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>allelic_variance</h1>
            
      

      <div class="d-none name"><code>allelic_variance.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="allelic-variance-test">Allelic variance test<a class="anchor" aria-label="anchor" href="#allelic-variance-test"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
Evaluating allele-specific expression (ASE) at the single-cell level can
reveal genes undergoing transient activation states. In scRNA data, such
gradual activation often appears as increased variation in the allelic
ratio distribution. To detect genes whose allelic variation differs from
the expected levels for genes with similar expression, ASPEN applies the
allelic variance test. In this test:
<p>We will use the same Bl6Cast dataset to demonstrate ASPEN-var test.
The initial processing steps are the same as described in the “Allelic
imbalance test” vignette. If you already have the output from
[<code><a href="../reference/estim_bbparams.html">estim_bbparams()</a></code>] function, you can skip directly to the .
 </p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#loading required libraries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ewonglab.github.io/ASPEN/">ASPEN</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hughjonesd.github.io/huxtable/" class="external-link">huxtable</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-allele-specifc-count-data">Loading allele-specifc count data<a class="anchor" aria-label="anchor" href="#loading-allele-specifc-count-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Bl6_Cast_a1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Bl6_Cast_tot"</span><span class="op">)</span></span>
<span><span class="va">load_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Bl6_Cast_cell_annot.xlsx"</span>, package <span class="op">=</span> <span class="st">"ASPEN"</span><span class="op">)</span></span>
<span><span class="va">cell_annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">load_file</span>, rowNames <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#adding barcode id</span></span>
<span><span class="va">cell_annot</span><span class="op">$</span><span class="va">cell_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">cell_annot</span><span class="op">$</span><span class="va">clone</span>, <span class="va">cell_annot</span><span class="op">$</span><span class="va">cell_barcode</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/to_md.html" class="external-link">print_md</a></span><span class="op">(</span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/as_huxtable.html" class="external-link">as_huxtable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cell_annot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;  cell_barcode background cell_type    cell_idents  clone  cell_id      </span></span>
<span><span class="co">#&gt; ------------- ---------- ------------ ------------ ------ -------------</span></span>
<span><span class="co">#&gt;  AAACCCACAGCA cast_b6    Gliogenic    Gliogenic    clone3 clone3_AAACC </span></span>
<span><span class="co">#&gt;  GATG                    progenitor   RGCs                CACAGCAGATG  </span></span>
<span><span class="co">#&gt;                          cells                                         </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;  AAACCCATCAGA cast_b6    Gliogenic    Gliogenic    clone3 clone3_AAACC </span></span>
<span><span class="co">#&gt;  GCGA                    progenitor   RGCs                CATCAGAGCGA  </span></span>
<span><span class="co">#&gt;                          cells                                         </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;  AAACGAAGTAGT cast_b6    Neurogenic   RGCs         clone3 clone3_AAACG </span></span>
<span><span class="co">#&gt;  TAGA                    progenitor                       AAGTAGTTAGA  </span></span>
<span><span class="co">#&gt;                          cells                                         </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;  AAACGAAGTGTT cast_b6    Intermediate IPCs         clone3 clone3_AAACG </span></span>
<span><span class="co">#&gt;  ATCG                    neuronal                         AAGTGTTATCG  </span></span>
<span><span class="co">#&gt;                          progenitors                                   </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;  AAACGAATCTCG cast_b6    Deep layer   Cortical     clone3 clone3_AAACG </span></span>
<span><span class="co">#&gt;  TCAC                    neurons      neurons             AATCTCGTCAC  </span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt;  AAAGGATGTATG cast_b6    Intermediate IPCs         clone3 clone3_AAAGG </span></span>
<span><span class="co">#&gt;  CTTG                    neuronal                         ATGTATGCTTG  </span></span>
<span><span class="co">#&gt;                          progenitors                                   </span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-pre-processing">Data pre-processing<a class="anchor" aria-label="anchor" href="#data-pre-processing"></a>
</h3>
<p>We load the reference allele and total counts and create a
<code>SingleCellExperiment</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#keeping annotated cells in the count matrices</span></span>
<span><span class="va">Cast_B6_a1</span> <span class="op">&lt;-</span> <span class="va">Cast_B6_a1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*_"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cell_annot</span><span class="op">$</span><span class="va">cell_barcode</span><span class="op">]</span></span>
<span><span class="va">Cast_B6_tot</span> <span class="op">&lt;-</span> <span class="va">Cast_B6_tot</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*_"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cell_annot</span><span class="op">$</span><span class="va">cell_barcode</span><span class="op">]</span></span>
<span><span class="co">#creating SingleCellExperiment object</span></span>
<span><span class="va">ase_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a></span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span>,</span>
<span>                                              tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Lowly expressed genes (expressed in less than 10 cells) are
removed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#removing lowly expressed genes</span></span>
<span><span class="va">ase_sce</span> <span class="op">&lt;-</span> <span class="va">ase_sce</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">ase_sce</span><span class="op">)</span><span class="op">[[</span><span class="st">'tot'</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/to_md.html" class="external-link">print_md</a></span><span class="op">(</span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/as_huxtable.html" class="external-link">as_huxtable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ase_sce</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ----------------------</span></span>
<span><span class="co">#&gt;                    V1 </span></span>
<span><span class="co">#&gt;                       </span></span>
<span><span class="co">#&gt;                  1551 </span></span>
<span><span class="co">#&gt;                       </span></span>
<span><span class="co">#&gt;                  6312 </span></span>
<span><span class="co">#&gt; ----------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="splitting-count-matrices-by-cell-type">Splitting count matrices by cell type<a class="anchor" aria-label="anchor" href="#splitting-count-matrices-by-cell-type"></a>
</h3>
<p>The test is run separately for each cell type. First, we split the
metadata object by cell types.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#splitting the metadata by cell type</span></span>
<span><span class="va">cell_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">cell_annot</span>, f <span class="op">=</span> <span class="va">cell_annot</span><span class="op">$</span><span class="va">cell_idents</span><span class="op">)</span></span></code></pre></div>
<p>Since beta-binomial parameters are estimated from raw counts, we
first split the raw total and reference allele count matrices by cell
type.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#splitting SingleCellExperiemnt object by cell types</span></span>
<span><span class="va">ase_sce_byct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cell_list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">ase_sce_byct</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ase_sce</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ase_sce</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cell_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cell_id</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#removing genes with low expression</span></span>
<span><span class="va">ase_sce_byct_filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ase_sce_byct</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> </span>
<span>                                          <span class="va">q</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">[[</span><span class="st">'tot'</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#extracting raw total counts</span></span>
<span><span class="va">tot_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ase_sce_byct_filt</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">[[</span><span class="st">'tot'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#extracting raw reference allele counts</span></span>
<span><span class="va">a1_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ase_sce_byct_filt</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">[[</span><span class="st">'a1'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#selecting genes that matched filtering criteria</span></span>
<span><span class="va">a1_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>,<span class="va">q</span><span class="op">)</span> <span class="va">p</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span>, <span class="op">]</span>, <span class="va">a1_mat</span>, <span class="va">tot_mat</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-beta-binomial-parameters">Estimating beta-binomial parameters<a class="anchor" aria-label="anchor" href="#estimating-beta-binomial-parameters"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_init_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span><span class="op">)</span> <span class="fu"><a href="../reference/estim_bbparams.html">estim_bbparams</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span>, min_cells <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, <span class="va">a1_mat</span>, <span class="va">tot_mat</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-lowly-expressed-genes">Defining lowly expressed genes<a class="anchor" aria-label="anchor" href="#defining-lowly-expressed-genes"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_cutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_init_params</span>, <span class="va">calc_mad</span><span class="op">)</span></span>
<span><span class="va">min_cutoff</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 0.002254469</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 0.001084665</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 0.002810162</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 0.00113423</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 0.001276519</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimate-appropriate-shrinkage-parameters">Estimate appropriate shrinkage parameters<a class="anchor" aria-label="anchor" href="#estimate-appropriate-shrinkage-parameters"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1001011</span><span class="op">)</span></span>
<span><span class="va">shrink_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span><span class="op">)</span> <span class="fu"><a href="../reference/estim_delta.html">estim_delta</a></span><span class="op">(</span><span class="va">p</span>, thetaFilter <span class="op">=</span> <span class="va">q</span><span class="op">)</span>,</span>
<span>                      <span class="va">bb_init_params</span>, <span class="va">min_cutoff</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">shrink_pars</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;     N delta </span></span>
<span><span class="co">#&gt;    17    18 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;     N delta </span></span>
<span><span class="co">#&gt;    13    15 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;     N delta </span></span>
<span><span class="co">#&gt;    17    17 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;     N delta </span></span>
<span><span class="co">#&gt;    14    17 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;     N delta </span></span>
<span><span class="co">#&gt;    20    19</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="performing-bayesian-shrinkage">Performing Bayesian shrinkage<a class="anchor" aria-label="anchor" href="#performing-bayesian-shrinkage"></a>
</h3>
<p>As explained in the “Allelic imbalance test” vignette, low-dispersion
genes are excluded from local regression trend modelling. However, these
genes are still evaluated for their depature from the expected levels of
allelic variation. To calculate stabilized dispersion for this gene
category, <code>shrinkAll</code> parameter in the
[<code><a href="../reference/correct_theta.html">correct_theta()</a></code>] function is set to <code>TRUE</code> (the
default option is <code>FALSE</code> - which is how it is used for the
[<code><a href="../reference/bb_mean.html">bb_mean()</a></code>] test).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bb_init_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_init_params</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="va">q</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">bb_theta</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">shrunk_estims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span><span class="op">)</span> <span class="fu"><a href="../reference/correct_theta.html">correct_theta</a></span><span class="op">(</span><span class="va">p</span>, N_set <span class="op">=</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, delta_set <span class="op">=</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, thetaFilter <span class="op">=</span> <span class="fl">0.001</span>, shrinkAll <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                 <span class="va">bb_init_params</span>, <span class="va">shrink_pars</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/to_md.html" class="external-link">print_md</a></span><span class="op">(</span><span class="fu"><a href="https://hughjonesd.github.io/huxtable/reference/as_huxtable.html" class="external-link">as_huxtable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">shrunk_estims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in to_md.huxtable(ht, ...): Couldn't print whole table in max_width = 80 characters.</span></span>
<span><span class="co">#&gt; Printing 8/13 columns.</span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;         N     AR tot_gene tot_gene    alpha     beta  bb_mu bb_theta </span></span>
<span><span class="co">#&gt;                     _mean _varianc                                   </span></span>
<span><span class="co">#&gt;                                  e                                   </span></span>
<span><span class="co">#&gt; --------- ------ -------- -------- -------- -------- ------ -------- </span></span>
<span><span class="co">#&gt;       850  0.984     5.94     29.3      175     2.41  0.986   0.0056 </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;  1.06e+03  0.999     8.21     45.4 4.41e+03     3.42  0.999   0.0002 </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;        37  0.976     1.09     1.78     14.6    0.343  0.977    0.067 </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;        25 0.0113    0.953     1.54    0.807     64.2 0.0124   0.0154 </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;  1.43e+03  0.695     21.3      322      184     84.5  0.685   0.0037 </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;        93 0.0039      1.4     3.57     25.2 6.94e+03 0.0036   0.0001 </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-for-the-depature-from-the-expected-levels-of-allelic-variation">Test for the depature from the expected levels of allelic
variation<a class="anchor" aria-label="anchor" href="#test-for-the-depature-from-the-expected-levels-of-allelic-variation"></a>
</h3>
<p>Unlike the test for alelic imbalance, [<code><a href="../reference/bb_var.html">bb_var()</a></code>] is
performed on the raw counts as normalization can distort the variation
between the counts. As with [<code><a href="../reference/bb_mean.html">bb_mean()</a></code>], we apply filtering
threshold requiring each gene to be expressed in at least five cells
with a minimum of 5 reads. Significance is assessed using a permutation
test. By default, the number of permutations is set to 500, but this can
be adjusted with <code>n_pmt</code> and <code>n_sim</code>
parameters.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span>, <span class="va">r</span><span class="op">)</span> <span class="fu"><a href="../reference/bb_var.html">bb_var</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">q</span>, estimates <span class="op">=</span> <span class="va">r</span>, </span>
<span>                                              min_cells <span class="op">=</span> <span class="fl">5</span>, min_counts <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                              n_pmt <span class="op">=</span> <span class="fl">500</span>, n_sim <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>, </span>
<span>                        <span class="va">a1_mat</span>, <span class="va">tot_mat</span>, <span class="va">shrunk_estims</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>For genes that do not meet the quality cut-off threshold (here: a
minimum of 5 cells with at least 5 mapped reads per cell), the variance
test is not performed. These genes will have <code>NA</code> values in
the output columns. We remove such genes before calculating the false
discovery rate (FDR).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">pval_disp</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#calculating fdr</span></span>
<span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> </span>
<span>                                <span class="op">{</span><span class="va">q</span><span class="op">$</span><span class="va">fdr_disp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">pval_disp</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span>;</span>
<span>                                 <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">fdr_disp</span><span class="op">)</span>,<span class="op">]</span>;</span>
<span>                                 <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
The output of [<code><a href="../reference/bb_var.html">bb_var()</a></code>] function is a table that combines
the output of the [<code><a href="../reference/estim_bbparams.html">estim_bbparams()</a></code>] and
[<code><a href="../reference/correct_theta.html">correct_theta()</a></code>] functions and adds the following
columns:\
<p>\</p>
</div>
<div class="section level3">
<h3 id="defining-genes-with-monoallelic-expression">Defining genes with monoallelic expression<a class="anchor" aria-label="anchor" href="#defining-genes-with-monoallelic-expression"></a>
</h3>
<p>Beta-binomial parameters can also be used to identify genes with
monoallelic expression and random monoallelic expression (RME). Genes
are classified as monoallelically expressed if their parameter estimates
meet either of the following criteria:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha &lt; 1</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\beta &lt; 1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">{</span><span class="va">q</span><span class="op">$</span><span class="va">monoal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">q</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>;</span>
<span>                                              <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> </span></code></pre></div>
<p>The number of genes classified as monoallelically expressed per cell
type:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">monoal</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 933  41 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 751  38 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 820  35 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    0    1 </span></span>
<span><span class="co">#&gt; 1233   45 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 999  41</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="va">q</span><span class="op">[</span><span class="va">q</span><span class="op">$</span><span class="va">monoal</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AR"</span>, <span class="st">"fdr_disp"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                      AR fdr_disp</span></span>
<span><span class="co">#&gt; Meg3          0.9722762        0</span></span>
<span><span class="co">#&gt; Kcnq1ot1      0.1969765        0</span></span>
<span><span class="co">#&gt; Rian          0.9651826        0</span></span>
<span><span class="co">#&gt; Snrpn         0.2622304        0</span></span>
<span><span class="co">#&gt; Bex2          0.7055834        0</span></span>
<span><span class="co">#&gt; 9330162G02Rik 0.3506396        0</span></span>
<span><span class="co">#&gt; Gpm6b         0.7670272        0</span></span>
<span><span class="co">#&gt; Pgrmc1        0.7442399        0</span></span>
<span><span class="co">#&gt; Ndufb11       0.7112723        0</span></span>
<span><span class="co">#&gt; Pcsk1n        0.6716533        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;                 AR fdr_disp</span></span>
<span><span class="co">#&gt; Meg3     0.9792260        0</span></span>
<span><span class="co">#&gt; Kcnq1ot1 0.1870162        0</span></span>
<span><span class="co">#&gt; Bex2     0.6371548        0</span></span>
<span><span class="co">#&gt; Gpm6b    0.5593086        0</span></span>
<span><span class="co">#&gt; Ndufb11  0.5618963        0</span></span>
<span><span class="co">#&gt; Pcsk1n   0.6507759        0</span></span>
<span><span class="co">#&gt; Tspan7   0.5777158        0</span></span>
<span><span class="co">#&gt; Sh3bgrl  0.6225959        0</span></span>
<span><span class="co">#&gt; Maged1   0.6058882        0</span></span>
<span><span class="co">#&gt; Mt3      0.6400374        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;                 AR fdr_disp</span></span>
<span><span class="co">#&gt; Meg3     0.9669701        0</span></span>
<span><span class="co">#&gt; Tuba1b   0.9287204        0</span></span>
<span><span class="co">#&gt; Kcnq1ot1 0.2204702        0</span></span>
<span><span class="co">#&gt; Bex2     0.7045911        0</span></span>
<span><span class="co">#&gt; Gpm6b    0.7531993        0</span></span>
<span><span class="co">#&gt; Ndufb11  0.7084227        0</span></span>
<span><span class="co">#&gt; Pcsk1n   0.7234285        0</span></span>
<span><span class="co">#&gt; Tspan7   0.7403820        0</span></span>
<span><span class="co">#&gt; Dcx      0.7080914        0</span></span>
<span><span class="co">#&gt; Uba1     0.7219881        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;                 AR fdr_disp</span></span>
<span><span class="co">#&gt; Hmgb1    0.9478554        0</span></span>
<span><span class="co">#&gt; Meg3     0.9668510        0</span></span>
<span><span class="co">#&gt; Kcnq1ot1 0.1750146        0</span></span>
<span><span class="co">#&gt; Bex2     0.6366406        0</span></span>
<span><span class="co">#&gt; Gpm6b    0.6032395        0</span></span>
<span><span class="co">#&gt; Ndufb11  0.5979667        0</span></span>
<span><span class="co">#&gt; Pcsk1n   0.6910833        0</span></span>
<span><span class="co">#&gt; Peg3     0.3223987        0</span></span>
<span><span class="co">#&gt; Tspan7   0.6856153        0</span></span>
<span><span class="co">#&gt; Uba1     0.6154512        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;                 AR fdr_disp</span></span>
<span><span class="co">#&gt; Meg3     0.9707027        0</span></span>
<span><span class="co">#&gt; Kcnq1ot1 0.1671930        0</span></span>
<span><span class="co">#&gt; Bex2     0.6559426        0</span></span>
<span><span class="co">#&gt; Gpm6b    0.6250239        0</span></span>
<span><span class="co">#&gt; Ndufb11  0.6090887        0</span></span>
<span><span class="co">#&gt; Pcsk1n   0.6901007        0</span></span>
<span><span class="co">#&gt; Peg3     0.3161015        0</span></span>
<span><span class="co">#&gt; Tspan7   0.6268899        0</span></span>
<span><span class="co">#&gt; Dcx      0.8404762        0</span></span>
<span><span class="co">#&gt; Uba1     0.6338756        0</span></span></code></pre></div>
<p>Visualizing allelic ratio distribution for selected genes</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#specifiying genes for plotting</span></span>
<span><span class="va">genes_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Olig2"</span>, <span class="st">"Meg3"</span>, <span class="st">"Kcnq1ot1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#generating data frame for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">genes_select</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="../reference/makedf.html">makedf</a></span><span class="op">(</span><span class="va">a1_mat</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="va">tot_mat</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, gene <span class="op">=</span> <span class="va">q</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_ar_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">p</span>,<span class="va">q</span>,<span class="va">r</span><span class="op">)</span> <span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">p</span>, gene <span class="op">=</span> <span class="va">q</span><span class="op">)</span>,</span>
<span>                 <span class="va">plot_data</span>, <span class="va">genes_select</span>, SIMPLIFY <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">grid.arrange</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_ar_dist</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="allelic_variance_files/figure-html/unnamed-chunk-16-1.png" width="720"></p>
</div>
<div class="section level3">
<h3 id="defining-genes-with-rme">Defining genes with RME<a class="anchor" aria-label="anchor" href="#defining-genes-with-rme"></a>
</h3>
<p>We define genes with RME as those with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha &lt; 1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\beta &lt; 1</annotation></semantics></math>
and approximately equal (the absolute difference between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is set to be less than 0.5).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">{</span><span class="va">q</span><span class="op">$</span><span class="va">abdiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">alpha</span> <span class="op">-</span> <span class="va">q</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>;</span>
<span>                                                   <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bb_var_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="op">{</span><span class="va">q</span><span class="op">$</span><span class="va">rme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> </span>
<span>                                                               <span class="va">q</span><span class="op">$</span><span class="va">beta</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">&amp;</span> </span>
<span>                                                               <span class="va">q</span><span class="op">$</span><span class="va">abdiff</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>;</span>
<span>                                                <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> </span></code></pre></div>
<p>The number of RME genes</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">q</span><span class="op">$</span><span class="va">rme</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 950  24 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 767  22 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 830  25 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    0    1 </span></span>
<span><span class="co">#&gt; 1248   30 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    0    1 </span></span>
<span><span class="co">#&gt; 1015   25</span></span></code></pre></div>
<p>Top 10 RME genes</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bb_var_res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="va">q</span><span class="op">[</span><span class="va">q</span><span class="op">$</span><span class="va">rme</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AR"</span>, <span class="st">"fdr_disp"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                AR fdr_disp</span></span>
<span><span class="co">#&gt; Bex2    0.7055834        0</span></span>
<span><span class="co">#&gt; Gpm6b   0.7670272        0</span></span>
<span><span class="co">#&gt; Pgrmc1  0.7442399        0</span></span>
<span><span class="co">#&gt; Ndufb11 0.7112723        0</span></span>
<span><span class="co">#&gt; Pcsk1n  0.6716533        0</span></span>
<span><span class="co">#&gt; Tspan7  0.7179053        0</span></span>
<span><span class="co">#&gt; Dcx     0.6763636        0</span></span>
<span><span class="co">#&gt; Uba1    0.6967240        0</span></span>
<span><span class="co">#&gt; Sh3bgrl 0.6997536        0</span></span>
<span><span class="co">#&gt; Maged1  0.6769483        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;                AR fdr_disp</span></span>
<span><span class="co">#&gt; Bex2    0.6371548        0</span></span>
<span><span class="co">#&gt; Gpm6b   0.5593086        0</span></span>
<span><span class="co">#&gt; Ndufb11 0.5618963        0</span></span>
<span><span class="co">#&gt; Pcsk1n  0.6507759        0</span></span>
<span><span class="co">#&gt; Tspan7  0.5777158        0</span></span>
<span><span class="co">#&gt; Sh3bgrl 0.6225959        0</span></span>
<span><span class="co">#&gt; Maged1  0.6058882        0</span></span>
<span><span class="co">#&gt; Mt3     0.6400374        0</span></span>
<span><span class="co">#&gt; Atrx    0.5412517        0</span></span>
<span><span class="co">#&gt; Nsdhl   0.5239680        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;                AR fdr_disp</span></span>
<span><span class="co">#&gt; Bex2    0.7045911        0</span></span>
<span><span class="co">#&gt; Gpm6b   0.7531993        0</span></span>
<span><span class="co">#&gt; Ndufb11 0.7084227        0</span></span>
<span><span class="co">#&gt; Pcsk1n  0.7234285        0</span></span>
<span><span class="co">#&gt; Tspan7  0.7403820        0</span></span>
<span><span class="co">#&gt; Dcx     0.7080914        0</span></span>
<span><span class="co">#&gt; Uba1    0.7219881        0</span></span>
<span><span class="co">#&gt; Sh3bgrl 0.7040431        0</span></span>
<span><span class="co">#&gt; Maged1  0.6903720        0</span></span>
<span><span class="co">#&gt; Mt3     0.4570011        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;                AR fdr_disp</span></span>
<span><span class="co">#&gt; Bex2    0.6366406        0</span></span>
<span><span class="co">#&gt; Gpm6b   0.6032395        0</span></span>
<span><span class="co">#&gt; Ndufb11 0.5979667        0</span></span>
<span><span class="co">#&gt; Pcsk1n  0.6910833        0</span></span>
<span><span class="co">#&gt; Tspan7  0.6856153        0</span></span>
<span><span class="co">#&gt; Uba1    0.6154512        0</span></span>
<span><span class="co">#&gt; Sh3bgrl 0.6500207        0</span></span>
<span><span class="co">#&gt; Maged1  0.6095045        0</span></span>
<span><span class="co">#&gt; Mt3     0.4722671        0</span></span>
<span><span class="co">#&gt; Zrsr2   0.5845943        0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;                AR fdr_disp</span></span>
<span><span class="co">#&gt; Bex2    0.6559426        0</span></span>
<span><span class="co">#&gt; Gpm6b   0.6250239        0</span></span>
<span><span class="co">#&gt; Ndufb11 0.6090887        0</span></span>
<span><span class="co">#&gt; Pcsk1n  0.6901007        0</span></span>
<span><span class="co">#&gt; Tspan7  0.6268899        0</span></span>
<span><span class="co">#&gt; Uba1    0.6338756        0</span></span>
<span><span class="co">#&gt; Sh3bgrl 0.6493541        0</span></span>
<span><span class="co">#&gt; Maged1  0.6356134        0</span></span>
<span><span class="co">#&gt; Mt3     0.5320794        0</span></span>
<span><span class="co">#&gt; Zrsr2   0.6386275        0</span></span></code></pre></div>
<p>We can visualize how far dispersion for the genes with RME deviates
from the expected dispersion for genes with similar expression</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene</span> <span class="op">=</span> <span class="st">"Bex2"</span></span>
<span><span class="va">exp_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_exp_disp.html">plot_exp_disp</a></span><span class="op">(</span><span class="va">bb_var_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#generating data frame for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makedf.html">makedf</a></span><span class="op">(</span><span class="va">a1_mat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">tot_mat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span><span class="va">ar_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">plot_data</span>,  gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">exp_theta</span>, <span class="va">ar_dist</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="allelic_variance_files/figure-html/unnamed-chunk-20-1.png" width="624"></p>
<p>Bex2 (brain expressed X-linked 2) gene shows a strong bias toward the
maternal (Bl6) allele. Its allelic variation greatly deviates from the
expected dispersion for genes with similar expression. We can compare
the allelic distribution with a gene that does not show deviation from a
common trend - for example, Npm1.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_var_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bex2"</span>, <span class="st">"Npm1"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AR"</span>, <span class="st">"tot_gene_mean"</span>, <span class="st">"fdr_disp"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table huxtable" data-quarto-disable-processing="true" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  ">
<col>
<col>
<col>
<tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">AR</th>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">tot_gene_mean</th>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">fdr_disp</th>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.706</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.01</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0    </td>
</tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.564</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.45</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.506</td>
</tr>
</table>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene</span> <span class="op">=</span> <span class="st">"Npm1"</span></span>
<span><span class="va">exp_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_exp_disp.html">plot_exp_disp</a></span><span class="op">(</span><span class="va">bb_var_res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#generating data frame for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makedf.html">makedf</a></span><span class="op">(</span><span class="va">a1_mat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">tot_mat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span><span class="va">ar_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">plot_data</span>,  gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">exp_theta</span>, <span class="va">ar_dist</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="allelic_variance_files/figure-html/unnamed-chunk-22-1.png" width="624"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Veronika Petrova, Muqing Niu, Thomas Vierbuchen, Emily Wong.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
