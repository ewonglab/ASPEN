<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dynamic_allelic_changes • ASPEN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="dynamic_allelic_changes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ASPEN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/allelic_imbalance.html">allelic_imbalance</a>
    </li>
    <li>
      <a href="../articles/allelic_variance.html">allelic_variance</a>
    </li>
    <li>
      <a href="../articles/dynamic_allelic_changes.html">dynamic_allelic_changes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>dynamic_allelic_changes</h1>
            
      

      <div class="hidden name"><code>dynamic_allelic_changes.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="dynamic-allelic-changes">Dynamic allelic changes<a class="anchor" aria-label="anchor" href="#dynamic-allelic-changes"></a>
</h2>
<div class="section level4">
<h4 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
To identify genes that change their allelic usage over developmental
time, ASPEN requires cell to be assigned a descrete time value. If
sequencing experiments were done across a number of time points, this is
simply identities of the respective experiment batch. Please note, that
the batch correction might be required to remove any technical batch
effects. Alternatively, cells can be ordered by the developmental
trajectory through pseudotime analysis (with tools like Monocle,
Slingshot, palantir, etc.). Pseudotime is a probability of a cell to be
in a terminal state, which is restricted to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>
interval. This vector can be divided into equal-sized bins and the cells
are grouped together. \ To test for changes in the mean allelic ratio
between the discrete time points, ASPEN evaluates whether a gene’s
allelic distribution is the same across the time points
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>)
or the allelic distribution is different
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>1</mn></msub><annotation encoding="application/x-tex">H_1</annotation></semantics></math>).
ASPEN goes through the following steps:\
</div>
<div class="section level4">
<h4 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#loading required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ASPEN</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: doParallel</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: iterators</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span><span class="co">#&gt; Loading required package: locfit</span></span>
<span><span class="co">#&gt; locfit 1.5-9.9    2024-03-01</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Loading required package: ggthemes</span></span>
<span><span class="co">#&gt; Loading required package: ggsci</span></span>
<span><span class="co">#&gt; Loading required package: ggpointdensity</span></span>
<span><span class="co">#&gt; Loading required package: ggExtra</span></span>
<span><span class="co">#&gt; Loading required package: ggrepel</span></span>
<span><span class="co">#&gt; Loading required package: ggpubr</span></span>
<span><span class="co">#&gt; Loading required package: assertthat</span></span>
<span><span class="co">#&gt; Loading required package: zoo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'zoo'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     as.Date, as.Date.numeric</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co">#&gt; Loading required package: data.table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'data.table'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:zoo':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     yearmon, yearqtr</span></span>
<span><span class="co">#&gt; Loading required package: VGAM</span></span>
<span><span class="co">#&gt; Loading required package: stats4</span></span>
<span><span class="co">#&gt; Loading required package: splines</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gridExtra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="loading-allele-specifc-count-data">Loading allele-specifc count data<a class="anchor" aria-label="anchor" href="#loading-allele-specifc-count-data"></a>
</h4>
<p>Like for other vignettes, we use mouse brain organoids data from
CastB6 hybrids. The pseudotime for this data was estimated using
palantir and we select three cell types, representing an early
neurodevelopment: radial glial cells (RGCs), intermediate progenitors
cells (IPCs), deep layer neurons (cortical neurons).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Cast_B6_a1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Cast_B6_tot"</span><span class="op">)</span></span>
<span><span class="va">load_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Cast_B6_cell_annot.xlsx"</span>, package <span class="op">=</span> <span class="st">"ASPEN"</span><span class="op">)</span></span>
<span><span class="va">cell_annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">load_file</span>, rowNames <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#loading pseudotime assignment</span></span>
<span><span class="va">load_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pseudotime_CastB6.xlsx"</span>, package <span class="op">=</span> <span class="st">"ASPEN"</span><span class="op">)</span></span>
<span><span class="va">pseudotime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html" class="external-link">read.xlsx</a></span><span class="op">(</span><span class="va">load_time</span>, rowNames <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    cell_id       time</span></span>
<span><span class="co">#&gt; 38 clone2_TACAGGTCAGAGATGC 0.01416797</span></span>
<span><span class="co">#&gt; 45 clone1_CTCATGCAGAGATCGC 0.01620139</span></span>
<span><span class="co">#&gt; 51 clone1_TAGGTACTCAACCCGG 0.01671255</span></span>
<span><span class="co">#&gt; 52 clone2_GACAGCCCAAACGTGG 0.01674076</span></span>
<span><span class="co">#&gt; 55 clone1_TCCGATCAGTGGTCAG 0.01755734</span></span>
<span><span class="co">#&gt; 60 clone2_AATCACGTCCCTCTAG 0.01817998</span></span></code></pre></div>
<p>We select the barcodes for the cell types that have pseudotime
estimates.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Cast_B6_a1</span> <span class="op">&lt;-</span> <span class="va">Cast_B6_a1</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">pseudotime</span><span class="op">$</span><span class="va">cell_id</span><span class="op">]</span></span>
<span><span class="va">Cast_B6_tot</span> <span class="op">&lt;-</span> <span class="va">Cast_B6_tot</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">pseudotime</span><span class="op">$</span><span class="va">cell_id</span><span class="op">]</span></span></code></pre></div>
<p>Remove low-expressed genes that have counts in less than 10 cells</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Remove low-expressed genes which have less than 10 cells </span></span>
<span><span class="va">Cast_B6_tot</span>  <span class="op">&lt;-</span> <span class="va">Cast_B6_tot</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="va">Cast_B6_a1</span>  <span class="op">&lt;-</span> <span class="va">Cast_B6_a1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Dividing pseudotime vector into five equal-sized groups</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudotime</span> <span class="op">&lt;-</span> <span class="va">pseudotime</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span>, <span class="va">pseudotime</span><span class="op">$</span><span class="va">cell_id</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">pseudotime</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">$</span><span class="va">time</span>, breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">$</span><span class="va">time</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pseudotime</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#adding cell ids to pseudotime obejct row names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pseudotime</span><span class="op">$</span><span class="va">cell_id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                         cell_id       time          group</span></span>
<span><span class="co">#&gt; clone1_AAACGAACATGTGCTA clone1_AAACGAACATGTGCTA 0.54637887  (0.541,0.566]</span></span>
<span><span class="co">#&gt; clone1_AAAGAACCACCTGCAG clone1_AAAGAACCACCTGCAG 0.80244252      (0.594,1]</span></span>
<span><span class="co">#&gt; clone1_AAAGGATGTACTCCGG clone1_AAAGGATGTACTCCGG 0.66697138      (0.594,1]</span></span>
<span><span class="co">#&gt; clone1_AAAGTCCAGCAATTCC clone1_AAAGTCCAGCAATTCC 0.60795731      (0.594,1]</span></span>
<span><span class="co">#&gt; clone1_AAAGTCCAGTGCTACT clone1_AAAGTCCAGTGCTACT 0.65369790      (0.594,1]</span></span>
<span><span class="co">#&gt; clone1_AAAGTCCGTAACCCGC clone1_AAAGTCCGTAACCCGC 0.04151659 (0.0142,0.424]</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pseudotime</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (0.0142,0.424]  (0.424,0.541]  (0.541,0.566]  (0.566,0.594]      (0.594,1] </span></span>
<span><span class="co">#&gt;            685            685            684            685            685</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1546 3424</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1546 3424</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt; 1546</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-beta-binomial-parameters">Estimating beta-binomial parameters<a class="anchor" aria-label="anchor" href="#estimating-beta-binomial-parameters"></a>
</h4>
<p>We start by estimating beta-binomial distribution parameters for each
gene across all cells. Theu will be used for the likelihood calculation
under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
- assumes no differences over pseudotime.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estim_bbparams.html">estim_bbparams</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, min_cells <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">global_shrunk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_theta_bygroup.html">correct_theta_bygroup</a></span><span class="op">(</span><span class="va">global_params</span>, delta_set <span class="op">=</span> <span class="fl">50</span>, N_set <span class="op">=</span> <span class="fl">30</span>, thetaFilter <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<p>Checking that the order of genes in the count matrix and the
parameter estimates object is the same.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">global_shrunk</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt; 1546</span></span></code></pre></div>
<p>Visualizing the local model fit and the shrunk dispersion
estimates</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_disp_fit_theta.html">plot_disp_fit_theta</a></span><span class="op">(</span><span class="va">global_shrunk</span>, midpoint <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">shrunk_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_disp.html">plot_disp</a></span><span class="op">(</span><span class="va">global_shrunk</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1e-03</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">fit_plot</span>, <span class="va">shrunk_plot</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 31 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_pointdensity()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-10-1.png" width="624"></p>
<p>Under alternative hypothesis, we assume that the alellic
distributions are different between the time points, so we repeat the
estimation and dispersion shrinkage steps for each group separately</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Estimating distribution parameters</span></span>
<span><span class="va">group_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estim_bbparams_bygroup.html">estim_bbparams_bygroup</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, metadata <span class="op">=</span> <span class="va">pseudotime</span>, split.var <span class="op">=</span> <span class="st">"group"</span>, min_cells <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#removing groups where optim did not converge</span></span>
<span><span class="va">group_params</span> <span class="op">&lt;-</span> <span class="va">group_params</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">group_params</span><span class="op">$</span><span class="va">bb_theta</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">group_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">group_params</span><span class="op">)</span></span>
<span><span class="va">shrunk_group_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_theta_bygroup.html">correct_theta_bygroup</a></span><span class="op">(</span><span class="va">group_params</span>, delta_set <span class="op">=</span> <span class="fl">50</span>, N_set <span class="op">=</span> <span class="fl">30</span>, thetaFilter <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<p>Visualizing the local model fit when each group-level observations
are treated as independent variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_plot_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_disp_fit_theta.html">plot_disp_fit_theta</a></span><span class="op">(</span><span class="va">shrunk_group_params</span>, midpoint <span class="op">=</span> <span class="fl">800</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">shrunk_plot_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_disp.html">plot_disp</a></span><span class="op">(</span><span class="va">shrunk_group_params</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1e-03</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">fit_plot_group</span>, <span class="va">shrunk_plot_group</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 482 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_pointdensity()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-12-1.png" width="624"></p>
</div>
<div class="section level4">
<h4 id="test-for-changes-in-allelic-distribution-over-time">Test for changes in allelic distribution over time<a class="anchor" aria-label="anchor" href="#test-for-changes-in-allelic-distribution-over-time"></a>
</h4>
<p>ASPEN requires the estimation for each gene to be provided as a
separate data frame. This can be done by splitting the group estimates
object by gene.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_params_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">shrunk_group_params</span>, f <span class="op">=</span> <span class="va">shrunk_group_params</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span></span>
<span><span class="co">#re-ordering to match order of genes in the count matrices </span></span>
<span><span class="va">group_params_list</span> <span class="op">&lt;-</span> <span class="va">group_params_list</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#Checking that the order of genes in the count matrix and the group-level parameter estimates object is the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">group_params_list</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Cast_B6_tot</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt; 1546</span></span></code></pre></div>
<p>Checking that the order of genes in global and group-level parameter
estimates objects are the same.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">global_shrunk</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">group_params_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt; 1546</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/allelicSwitch.html">allelicSwitch</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, min_cells <span class="op">=</span> <span class="fl">5</span>, metadata <span class="op">=</span> <span class="va">pseudotime</span>,  split.var <span class="op">=</span> <span class="st">"group"</span>, estimates <span class="op">=</span> <span class="va">global_shrunk</span>, estimates_group <span class="op">=</span> <span class="va">group_params_list</span><span class="op">)</span></span></code></pre></div>
<p>For genes in which the quality cut-off threshold (here we used a
minimum of five cells with at least of five mapped reads) was not met,
the inference is not performed, Those genes have NA values in the fields
specified above. We remove those genes and calculate fdr’s.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span> <span class="op">&lt;-</span> <span class="va">pseudot_change</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#at which time point the variation in allelic ratio's deviates from the expected levels</span></span>
<span><span class="co">#p-values for each time bin are the last five column, so p.adjust is applied to all of them </span></span>
<span><span class="va">pseudot_change</span><span class="op">[</span>,<span class="fl">35</span><span class="op">:</span><span class="fl">39</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">[</span>,<span class="fl">30</span><span class="op">:</span><span class="fl">34</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">q</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">q</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fl">35</span><span class="op">:</span><span class="fl">39</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"fdr_bin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#allelic distribution changes over time</span></span>
<span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">pval</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span></span>
<span><span class="co">#variance changes overtime, whilst keeping the mean AR constant</span></span>
<span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">pval_var</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span></span></code></pre></div>
<p>Top 10 genes with significant changes in allelic distribution over
pseudotime</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span> <span class="op">&lt;-</span> <span class="va">pseudot_change</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_mean</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">pseudot_change</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu_global"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mu_group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"fdr_mean"</span>, <span class="st">"fdr_var"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;          mu_global mu_group.0.0142.0.424. mu_group.0.424.0.541.</span></span>
<span><span class="co">#&gt; Dbi         0.5522                 0.5142                0.5396</span></span>
<span><span class="co">#&gt; Apoe        0.5452                 0.4893                0.6099</span></span>
<span><span class="co">#&gt; Tuba1b      0.9290                 0.9742                0.9741</span></span>
<span><span class="co">#&gt; Kcnq1ot1    0.1974                 0.1248                0.2339</span></span>
<span><span class="co">#&gt; Ptn         0.5398                 0.5680                0.5267</span></span>
<span><span class="co">#&gt; Pcsk1n      0.6986                 0.7048                0.7618</span></span>
<span><span class="co">#&gt; Cst3        0.4578                 0.4213                0.4571</span></span>
<span><span class="co">#&gt; Map1b       0.5269                 0.5934                0.5919</span></span>
<span><span class="co">#&gt; Pttg1       0.3496                 0.4081                0.1789</span></span>
<span><span class="co">#&gt; Basp1       0.4898                 0.5850                0.5056</span></span>
<span><span class="co">#&gt;          mu_group.0.541.0.566. mu_group.0.566.0.594. mu_group.0.594.1.</span></span>
<span><span class="co">#&gt; Dbi                     0.6159                0.6574            0.6389</span></span>
<span><span class="co">#&gt; Apoe                    0.7793                0.8007            0.7980</span></span>
<span><span class="co">#&gt; Tuba1b                  0.8975                0.8936            0.8626</span></span>
<span><span class="co">#&gt; Kcnq1ot1                0.3199                0.2634            0.1082</span></span>
<span><span class="co">#&gt; Ptn                     0.4766                0.4830            0.5553</span></span>
<span><span class="co">#&gt; Pcsk1n                  0.7636                0.6900            0.6035</span></span>
<span><span class="co">#&gt; Cst3                    0.4864                0.5089            0.4971</span></span>
<span><span class="co">#&gt; Map1b                   0.5483                0.5087            0.4900</span></span>
<span><span class="co">#&gt; Pttg1                   0.5431                0.8364            0.7680</span></span>
<span><span class="co">#&gt; Basp1                   0.4748                0.4684            0.4901</span></span>
<span><span class="co">#&gt;              fdr_mean      fdr_var</span></span>
<span><span class="co">#&gt; Dbi      8.247945e-93 2.926431e-67</span></span>
<span><span class="co">#&gt; Apoe     6.624040e-43 5.656412e-05</span></span>
<span><span class="co">#&gt; Tuba1b   2.506204e-35 1.000000e+00</span></span>
<span><span class="co">#&gt; Kcnq1ot1 1.975608e-28 1.000000e+00</span></span>
<span><span class="co">#&gt; Ptn      1.168465e-25 4.538646e-23</span></span>
<span><span class="co">#&gt; Pcsk1n   1.315095e-24 9.358792e-07</span></span>
<span><span class="co">#&gt; Cst3     1.315095e-24 1.000000e+00</span></span>
<span><span class="co">#&gt; Map1b    1.500452e-24 1.000000e+00</span></span>
<span><span class="co">#&gt; Pttg1    6.351125e-24 1.000000e+00</span></span>
<span><span class="co">#&gt; Basp1    3.534458e-20 1.000000e+00</span></span></code></pre></div>
<p>We can pick the genes that only change in their mean allelic ratio
over pseudotime. For such genes we set fdr_var &gt; 0.05.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">[</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_var</span> <span class="op">&gt;</span> <span class="fl">0.05</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu_global"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mu_group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"fdr_mean"</span>, <span class="st">"fdr_var"</span><span class="op">)</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;          mu_global mu_group.0.0142.0.424. mu_group.0.424.0.541.</span></span>
<span><span class="co">#&gt; Tuba1b      0.9290                 0.9742                0.9741</span></span>
<span><span class="co">#&gt; Kcnq1ot1    0.1974                 0.1248                0.2339</span></span>
<span><span class="co">#&gt; Cst3        0.4578                 0.4213                0.4571</span></span>
<span><span class="co">#&gt; Map1b       0.5269                 0.5934                0.5919</span></span>
<span><span class="co">#&gt; Pttg1       0.3496                 0.4081                0.1789</span></span>
<span><span class="co">#&gt; Basp1       0.4898                 0.5850                0.5056</span></span>
<span><span class="co">#&gt; Oaz1        0.2587                 0.2139                0.2136</span></span>
<span><span class="co">#&gt; Stmn4       0.5105                 0.6520                0.5928</span></span>
<span><span class="co">#&gt; Mtarc2      0.5276                 0.3998                0.4934</span></span>
<span><span class="co">#&gt; Dcx         0.7111                 0.8811                0.7948</span></span>
<span><span class="co">#&gt;          mu_group.0.541.0.566. mu_group.0.566.0.594. mu_group.0.594.1.</span></span>
<span><span class="co">#&gt; Tuba1b                  0.8975                0.8936            0.8626</span></span>
<span><span class="co">#&gt; Kcnq1ot1                0.3199                0.2634            0.1082</span></span>
<span><span class="co">#&gt; Cst3                    0.4864                0.5089            0.4971</span></span>
<span><span class="co">#&gt; Map1b                   0.5483                0.5087            0.4900</span></span>
<span><span class="co">#&gt; Pttg1                   0.5431                0.8364            0.7680</span></span>
<span><span class="co">#&gt; Basp1                   0.4748                0.4684            0.4901</span></span>
<span><span class="co">#&gt; Oaz1                    0.2902                0.2988            0.3334</span></span>
<span><span class="co">#&gt; Stmn4                   0.5085                0.5011            0.4631</span></span>
<span><span class="co">#&gt; Mtarc2                  0.5796                0.6829            0.6281</span></span>
<span><span class="co">#&gt; Dcx                     0.7423                0.6764            0.6216</span></span>
<span><span class="co">#&gt;              fdr_mean   fdr_var</span></span>
<span><span class="co">#&gt; Tuba1b   2.506204e-35 1.0000000</span></span>
<span><span class="co">#&gt; Kcnq1ot1 1.975608e-28 1.0000000</span></span>
<span><span class="co">#&gt; Cst3     1.315095e-24 1.0000000</span></span>
<span><span class="co">#&gt; Map1b    1.500452e-24 1.0000000</span></span>
<span><span class="co">#&gt; Pttg1    6.351125e-24 1.0000000</span></span>
<span><span class="co">#&gt; Basp1    3.534458e-20 1.0000000</span></span>
<span><span class="co">#&gt; Oaz1     6.136281e-19 1.0000000</span></span>
<span><span class="co">#&gt; Stmn4    1.407075e-18 1.0000000</span></span>
<span><span class="co">#&gt; Mtarc2   2.395005e-18 1.0000000</span></span>
<span><span class="co">#&gt; Dcx      2.584960e-15 0.5741832</span></span></code></pre></div>
<p>Visualizing changes along pseudotime</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene</span> <span class="op">&lt;-</span> <span class="st">"Cst3"</span></span>
<span><span class="co">#generating data frame for plotting</span></span>
<span><span class="co">#plot_data &lt;- makedf(Cast_B6_a1, Cast_B6_tot, gene = gene, metadata = pseudotime, order.by = "time", split.var = "group")</span></span>
<span></span>
<span><span class="va">simul_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_plotdf_simul.html">make_plotdf_simul</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, gene <span class="op">=</span> <span class="va">gene</span>, estimates_group <span class="op">=</span> <span class="va">group_params_list</span>,</span>
<span>                                metadata <span class="op">=</span> <span class="va">pseudotime</span>, order.by <span class="op">=</span> <span class="st">"time"</span>, split.var <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">simul_data</span>, gene <span class="op">=</span> <span class="va">gene</span>, add.density <span class="op">=</span> <span class="cn">FALSE</span>, min_counts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">Index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>, <span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Ordered pseudotime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-19-1.png" width="384"></p>
<p>Boxplot to assess ASE at each time point. Differences in the mean
values are confirmed with Wilcox two-sided test.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/geBoxplot.html">geBoxplot</a></span><span class="op">(</span><span class="va">simul_data</span>, allele1 <span class="op">=</span> <span class="st">"Bl6"</span>, allele2 <span class="op">=</span> <span class="st">"Cast"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 847 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_boxplot()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 847 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_compare_means()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-20-1.png" width="384"></p>
<p>Plotting allelic ratio density using original data and the original
estimated theta and common theta and allelic ratio distribution from
data simulated from the common theta.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_theta_density.html">plot_theta_density</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-21-1.png" width="384"></p>
<p>There is strong support that the observed ASE dispersion deviates
from the expected dispersion.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span><span class="op">[</span><span class="va">gene</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"fdr_bin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;          fdr_bin1     fdr_bin2     fdr_bin3   fdr_bin4   fdr_bin5</span></span>
<span><span class="co">#&gt; Cst3 2.169379e-08 1.103532e-35 7.315844e-08 0.01232734 0.02625956</span></span></code></pre></div>
<p>Visualizing the distance from the common dispersion trend for all
pseudotime group.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_exp_disp.html">plot_exp_disp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">shrunk_group_params</span><span class="op">)</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-23-1.png" width="384"></p>
<p>Alternatively, we can select genes that have significant changes in
variance but not in the mean allelic ratio.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span> <span class="op">&lt;-</span> <span class="va">pseudot_change</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_var</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">[</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_mean</span> <span class="op">&gt;</span> <span class="fl">0.05</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu_global"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mu_group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"fdr_mean"</span>, <span class="st">"fdr_var"</span><span class="op">)</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;           mu_global mu_group.0.0142.0.424. mu_group.0.424.0.541.</span></span>
<span><span class="co">#&gt; Uchl1        0.9993                 0.9989                0.9990</span></span>
<span><span class="co">#&gt; Ubb          0.9993                 0.9979                0.9991</span></span>
<span><span class="co">#&gt; Rpl23a       0.0010                 0.0027                0.0011</span></span>
<span><span class="co">#&gt; Rps24-ps3    0.0022                 0.0031                0.0051</span></span>
<span><span class="co">#&gt; Gm9794       0.0098                 0.0052                0.0101</span></span>
<span><span class="co">#&gt; Hnrnpf       0.9757                 0.9702                0.9846</span></span>
<span><span class="co">#&gt; Rplp0        0.5598                 0.5595                0.5599</span></span>
<span><span class="co">#&gt; Rps26        0.8233                 0.8196                0.8206</span></span>
<span><span class="co">#&gt; Eef1a1       0.5530                 0.5607                0.5541</span></span>
<span><span class="co">#&gt; Tbcb         0.6548                 0.6651                0.6521</span></span>
<span><span class="co">#&gt;           mu_group.0.541.0.566. mu_group.0.566.0.594. mu_group.0.594.1.</span></span>
<span><span class="co">#&gt; Uchl1                    1.0000                0.9982            0.9958</span></span>
<span><span class="co">#&gt; Ubb                      0.9975                0.9992            0.9990</span></span>
<span><span class="co">#&gt; Rpl23a                   0.0013                0.0025            0.0000</span></span>
<span><span class="co">#&gt; Rps24-ps3                0.0000                0.0034            0.0000</span></span>
<span><span class="co">#&gt; Gm9794                   0.0099                0.0133            0.0126</span></span>
<span><span class="co">#&gt; Hnrnpf                   0.9752                0.9741            0.9677</span></span>
<span><span class="co">#&gt; Rplp0                    0.5584                0.5633            0.5574</span></span>
<span><span class="co">#&gt; Rps26                    0.8168                0.8404            0.8170</span></span>
<span><span class="co">#&gt; Eef1a1                   0.5463                0.5483            0.5575</span></span>
<span><span class="co">#&gt; Tbcb                     0.6541                0.6471            0.6611</span></span>
<span><span class="co">#&gt;             fdr_mean       fdr_var</span></span>
<span><span class="co">#&gt; Uchl1     1.00000000  0.000000e+00</span></span>
<span><span class="co">#&gt; Ubb       1.00000000  0.000000e+00</span></span>
<span><span class="co">#&gt; Rpl23a    1.00000000  0.000000e+00</span></span>
<span><span class="co">#&gt; Rps24-ps3 0.10389829 1.182520e-105</span></span>
<span><span class="co">#&gt; Gm9794    0.11260540  3.589407e-77</span></span>
<span><span class="co">#&gt; Hnrnpf    0.08050519  8.332093e-25</span></span>
<span><span class="co">#&gt; Rplp0     0.09178200  3.448051e-21</span></span>
<span><span class="co">#&gt; Rps26     0.31516148  5.058523e-21</span></span>
<span><span class="co">#&gt; Eef1a1    1.00000000  2.129124e-13</span></span>
<span><span class="co">#&gt; Tbcb      0.11675307  4.148624e-12</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene</span> <span class="op">&lt;-</span> <span class="st">"Eno1"</span></span>
<span><span class="co">#generating data frame for plotting</span></span>
<span><span class="co">#plot_data &lt;- makedf(Cast_B6_a1, Cast_B6_tot, gene = gene, metadata = pseudotime, order.by = "time", split.var = "group")</span></span>
<span></span>
<span><span class="va">simul_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_plotdf_simul.html">make_plotdf_simul</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, gene <span class="op">=</span> <span class="va">gene</span>, estimates_group <span class="op">=</span> <span class="va">group_params_list</span>,</span>
<span>                                metadata <span class="op">=</span> <span class="va">pseudotime</span>, order.by <span class="op">=</span> <span class="st">"time"</span>, split.var <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">simul_data</span>, gene <span class="op">=</span> <span class="va">gene</span>, add.density <span class="op">=</span> <span class="cn">FALSE</span>, min_counts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">Index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>, <span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Ordered pseudotime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-25-1.png" width="384"></p>
<p>Boxplot to assess ASE at each time point. Differences in the mean
values are confirmed with Wilcox two-sided test.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/geBoxplot.html">geBoxplot</a></span><span class="op">(</span><span class="va">simul_data</span>, allele1 <span class="op">=</span> <span class="st">"Bl6"</span>, allele2 <span class="op">=</span> <span class="st">"Cast"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1019 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_boxplot()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1019 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_compare_means()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-26-1.png" width="384"></p>
<p>Plotting allelic ratio density using original data and the original
estimated theta and common theta and allelic ratio distribution from
data simulated from the common theta.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_theta_density.html">plot_theta_density</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-27-1.png" width="384"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span><span class="op">[</span><span class="va">gene</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"fdr_bin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;      fdr_bin1  fdr_bin2  fdr_bin3 fdr_bin4  fdr_bin5</span></span>
<span><span class="co">#&gt; Eno1 0.936023 0.8154714 0.8982406 0.914615 0.8414176</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_exp_disp.html">plot_exp_disp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">shrunk_group_params</span><span class="op">)</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-29-1.png" width="384"></p>
<p>Based on the test results that tells us at which time point the
observed dispersion deviates from the expected, we can select genes
where the change occurs at the later time points.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudot_change</span> <span class="op">&lt;-</span> <span class="va">pseudot_change</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">$</span><span class="va">fdr_bin5</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu_global"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mu_group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"fdr_mean"</span>, <span class="st">"fdr_var"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"fdr_bin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;          mu_global mu_group.0.0142.0.424. mu_group.0.424.0.541.</span></span>
<span><span class="co">#&gt; Pcsk1n      0.6986                 0.7048                0.7618</span></span>
<span><span class="co">#&gt; Xist        0.4454                 0.3859                0.4362</span></span>
<span><span class="co">#&gt; Bex2        0.7048                 0.6815                0.7226</span></span>
<span><span class="co">#&gt; Rps4x       0.5971                 0.5618                0.6393</span></span>
<span><span class="co">#&gt; Meg3        0.9708                 0.9683                0.9614</span></span>
<span><span class="co">#&gt; Dcx         0.7111                 0.8811                0.7948</span></span>
<span><span class="co">#&gt; Atrx        0.6290                 0.6038                0.6589</span></span>
<span><span class="co">#&gt; Kcnq1ot1    0.1974                 0.1248                0.2339</span></span>
<span><span class="co">#&gt; Tsix        0.4199                 0.3359                0.3026</span></span>
<span><span class="co">#&gt; Ndufb11     0.6919                 0.6427                0.7193</span></span>
<span><span class="co">#&gt; Stmn4       0.5105                 0.6520                0.5928</span></span>
<span><span class="co">#&gt; Zrsr2       0.6541                 0.6590                0.6880</span></span>
<span><span class="co">#&gt; Gpm6b       0.7212                 0.6311                0.7651</span></span>
<span><span class="co">#&gt; Uba1        0.6990                 0.6310                0.7294</span></span>
<span><span class="co">#&gt; Tubb2a      0.5713                 0.5974                0.6063</span></span>
<span><span class="co">#&gt; Sh3bgrl     0.7032                 0.6758                0.7295</span></span>
<span><span class="co">#&gt; Nono        0.6196                 0.5200                0.6204</span></span>
<span><span class="co">#&gt; Maged1      0.6770                 0.6433                0.7064</span></span>
<span><span class="co">#&gt; Tspan7      0.6994                 0.6353                0.7342</span></span>
<span><span class="co">#&gt; Epha5       0.5956                 0.6060                0.6226</span></span>
<span><span class="co">#&gt;          mu_group.0.541.0.566. mu_group.0.566.0.594. mu_group.0.594.1.</span></span>
<span><span class="co">#&gt; Pcsk1n                  0.7636                0.6900            0.6035</span></span>
<span><span class="co">#&gt; Xist                    0.4087                0.5188            0.4932</span></span>
<span><span class="co">#&gt; Bex2                    0.7462                0.7102            0.6647</span></span>
<span><span class="co">#&gt; Rps4x                   0.6595                0.5884            0.5088</span></span>
<span><span class="co">#&gt; Meg3                    0.9743                0.9868            0.9634</span></span>
<span><span class="co">#&gt; Dcx                     0.7423                0.6764            0.6216</span></span>
<span><span class="co">#&gt; Atrx                    0.6838                0.6384            0.5719</span></span>
<span><span class="co">#&gt; Kcnq1ot1                0.3199                0.2634            0.1082</span></span>
<span><span class="co">#&gt; Tsix                    0.4045                0.5000            0.4766</span></span>
<span><span class="co">#&gt; Ndufb11                 0.7431                0.6945            0.6464</span></span>
<span><span class="co">#&gt; Stmn4                   0.5085                0.5011            0.4631</span></span>
<span><span class="co">#&gt; Zrsr2                   0.6750                0.6283            0.6142</span></span>
<span><span class="co">#&gt; Gpm6b                   0.8238                0.7506            0.6941</span></span>
<span><span class="co">#&gt; Uba1                    0.7689                0.6961            0.6595</span></span>
<span><span class="co">#&gt; Tubb2a                  0.5586                0.5482            0.5550</span></span>
<span><span class="co">#&gt; Sh3bgrl                 0.7448                0.6898            0.6579</span></span>
<span><span class="co">#&gt; Nono                    0.6766                0.6456            0.6326</span></span>
<span><span class="co">#&gt; Maged1                  0.7384                0.6707            0.6218</span></span>
<span><span class="co">#&gt; Tspan7                  0.7561                0.7353            0.6763</span></span>
<span><span class="co">#&gt; Epha5                   0.6114                0.5666            0.5939</span></span>
<span><span class="co">#&gt;              fdr_mean      fdr_var      fdr_bin1      fdr_bin2      fdr_bin3</span></span>
<span><span class="co">#&gt; Pcsk1n   1.315095e-24 9.358792e-07  1.271054e-53  7.455691e-31 1.498144e-114</span></span>
<span><span class="co">#&gt; Xist     1.625317e-06 1.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; Bex2     1.688546e-09 6.575780e-05  1.189812e-58 5.471239e-103  3.717006e-90</span></span>
<span><span class="co">#&gt; Rps4x    3.719985e-12 4.925089e-08  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; Meg3     2.187850e-04 4.886895e-21  1.139657e-21  9.003545e-04  1.581214e-16</span></span>
<span><span class="co">#&gt; Dcx      2.584960e-15 5.741832e-01  5.706308e-01  1.413974e-15  1.778323e-65</span></span>
<span><span class="co">#&gt; Atrx     2.054456e-06 6.263015e-04  5.228707e-32  2.231989e-24  1.930753e-48</span></span>
<span><span class="co">#&gt; Kcnq1ot1 1.975608e-28 1.000000e+00  8.707001e-31  2.736485e-14  2.126572e-20</span></span>
<span><span class="co">#&gt; Tsix     2.588287e-05 6.105668e-02  3.445124e-06  1.940190e-05  2.958677e-05</span></span>
<span><span class="co">#&gt; Ndufb11  1.165048e-07 2.286342e-05  2.265334e-75 4.628968e-110  1.160445e-44</span></span>
<span><span class="co">#&gt; Stmn4    1.407075e-18 1.000000e+00  8.107721e-01  7.107849e-01  6.964470e-01</span></span>
<span><span class="co">#&gt; Zrsr2    3.344800e-03 1.000000e+00  3.826970e-33  5.957675e-41  7.648714e-33</span></span>
<span><span class="co">#&gt; Gpm6b    5.601013e-12 4.096251e-11 1.155333e-275  5.489996e-99  5.774631e-14</span></span>
<span><span class="co">#&gt; Uba1     5.674379e-07 5.279061e-10  1.729318e-17  4.652912e-14  9.707794e-23</span></span>
<span><span class="co">#&gt; Tubb2a   2.055918e-04 6.040028e-03  1.479296e-33  1.071718e-32  1.190231e-22</span></span>
<span><span class="co">#&gt; Sh3bgrl  1.560995e-06 1.066756e-09  4.824393e-25  2.120519e-56  4.571916e-40</span></span>
<span><span class="co">#&gt; Nono     8.203414e-05 1.075817e-02  1.613200e-16  3.088464e-18  2.469455e-20</span></span>
<span><span class="co">#&gt; Maged1   2.632396e-06 7.693910e-11  2.300461e-45  2.248452e-43  2.690548e-22</span></span>
<span><span class="co">#&gt; Tspan7   6.840800e-07 1.000000e+00 1.756556e-110  3.147294e-21  1.251326e-09</span></span>
<span><span class="co">#&gt; Epha5    3.030531e-09 1.808130e-07  1.613260e-07  1.964899e-04  1.036251e-03</span></span>
<span><span class="co">#&gt;               fdr_bin4      fdr_bin5</span></span>
<span><span class="co">#&gt; Pcsk1n   2.191867e-288  0.000000e+00</span></span>
<span><span class="co">#&gt; Xist      0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; Bex2     3.969746e-158 1.394352e-215</span></span>
<span><span class="co">#&gt; Rps4x     0.000000e+00 6.955944e-175</span></span>
<span><span class="co">#&gt; Meg3      4.892125e-15 7.983808e-148</span></span>
<span><span class="co">#&gt; Dcx      4.027545e-122  2.743416e-96</span></span>
<span><span class="co">#&gt; Atrx      6.369967e-75  1.280456e-83</span></span>
<span><span class="co">#&gt; Kcnq1ot1  7.513234e-23  6.046794e-58</span></span>
<span><span class="co">#&gt; Tsix      3.186436e-13  4.186211e-41</span></span>
<span><span class="co">#&gt; Ndufb11   5.259557e-48  1.830778e-35</span></span>
<span><span class="co">#&gt; Stmn4     6.630133e-10  3.543360e-31</span></span>
<span><span class="co">#&gt; Zrsr2     1.813532e-31  1.480536e-29</span></span>
<span><span class="co">#&gt; Gpm6b     3.261277e-13  3.096372e-29</span></span>
<span><span class="co">#&gt; Uba1      1.229513e-46  4.057825e-29</span></span>
<span><span class="co">#&gt; Tubb2a    2.227567e-30  1.602587e-28</span></span>
<span><span class="co">#&gt; Sh3bgrl   2.579668e-63  5.284822e-25</span></span>
<span><span class="co">#&gt; Nono      6.731661e-23  1.552763e-24</span></span>
<span><span class="co">#&gt; Maged1    1.574203e-21  7.186011e-24</span></span>
<span><span class="co">#&gt; Tspan7    5.941502e-32  7.067082e-19</span></span>
<span><span class="co">#&gt; Epha5     7.421459e-04  1.390156e-18</span></span></code></pre></div>
<p>We examine gene Stmn4 where the significant changes in dispersion
occurs at time bin 4 and 5.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene</span> <span class="op">&lt;-</span> <span class="st">"Stmn4"</span></span>
<span><span class="va">pseudot_change</span><span class="op">[</span><span class="va">gene</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"fdr_bin"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pseudot_change</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;        fdr_bin1  fdr_bin2 fdr_bin3     fdr_bin4    fdr_bin5</span></span>
<span><span class="co">#&gt; Stmn4 0.8107721 0.7107849 0.696447 6.630133e-10 3.54336e-31</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">simul_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_plotdf_simul.html">make_plotdf_simul</a></span><span class="op">(</span><span class="va">Cast_B6_a1</span>, <span class="va">Cast_B6_tot</span>, gene <span class="op">=</span> <span class="va">gene</span>, estimates_group <span class="op">=</span> <span class="va">group_params_list</span>,</span>
<span>                                metadata <span class="op">=</span> <span class="va">pseudotime</span>, order.by <span class="op">=</span> <span class="st">"time"</span>, split.var <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_distr.html">plot_distr</a></span><span class="op">(</span><span class="va">simul_data</span>, gene <span class="op">=</span> <span class="va">gene</span>, add.density <span class="op">=</span> <span class="cn">FALSE</span>, min_counts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">Index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>, <span class="va">simul_data</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Ordered pseudotime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-32-1.png" width="384"></p>
<p>Boxplot to assess ASE at each time point. Differences in the mean
values are confirmed with Wilcox two-sided test.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/geBoxplot.html">geBoxplot</a></span><span class="op">(</span><span class="va">simul_data</span>, allele1 <span class="op">=</span> <span class="st">"Bl6"</span>, allele2 <span class="op">=</span> <span class="st">"Cast"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1139 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_boxplot()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1139 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_compare_means()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-33-1.png" width="384"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_theta_density.html">plot_theta_density</a></span><span class="op">(</span><span class="va">simul_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-34-1.png" width="384"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_exp_disp.html">plot_exp_disp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">shrunk_group_params</span><span class="op">)</span>, gene <span class="op">=</span> <span class="va">gene</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="dynamic_allelic_changes_files/figure-html/unnamed-chunk-35-1.png" width="384"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Veronika Petrova, Emily Wong.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
